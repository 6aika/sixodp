---

# To run: ansible-playbook -v -i inventories/vagrant deploy-all.yml

- hosts: mainserver
  sudo: true
  vars_files:
    - "vars/common.yml"
    - "vars/environment-specific/{{ deployment_environment_id }}.yml"
    - "{{ secrets_file_path }}"
  roles:
    - os-base
    - postgre
    - solr3
    - redis
    - nginx
    - apache
    - ckan
    - { role: ckan-extension, ckanext: ckanext-apicatalog_scheming }
    - { role: ckan-extension, ckanext: ckanext-apicatalog_ui }
    - solr-reindex
  handlers:
    - include: handlers/handlers.yml
