- name: Set hostname (systemd)
  hostname: name="{{ internal_hostname }}"

- name: Restart MySQL
  service: name=mariadb state=restarted enabled=yes

- name: Add Piwik MySQL database
  mysql_db: name="piwik" state="present" login_user="root" login_password=""

- name: Add piwik MySQL user
  mysql_user: name="piwik" state="present" password="piwik" login_user="root" login_password="" priv="piwik.*:ALL"

- name: Download latest piwik
  get_url: url=http://builds.piwik.org/latest.zip dest=/tmp/latest_piwik.zip

- name: Extract piwik
  unarchive: src=/tmp/latest_piwik.zip dest=/var/www copy=no owner=apache group=apache

- name: Copy apache configuration
  template: src=httpd.conf.j2 dest=/etc/httpd/conf/httpd.conf mode="0644" owner=root group=root

- name: Restart Apache
  service: name=httpd state=restarted enabled=yes

- name: Allow Apache on network (SELinux)
  seboolean: name=httpd_can_network_connect state=yes persistent=yes

- name: Allow Apache to modify files (SELinux)
  seboolean: name=httpd_unified state=yes persistent=yes

